}<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>F√©nix OS - Arquitectura de Libertad</title>
    
    <!-- 1. Cargar React y ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- 2. Cargar Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- 3. Cargar Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 4. Fuentes -->
    <link href="https://fonts.googleapis.com/css2?family=SF+Pro+Display:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; }
        .font-display { font-family: 'SF Pro Display', 'Inter', sans-serif; }
        
        /* Efecto Liquid Glass Realista */
        .glass-panel {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.6);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.07);
        }
        
        .glass-card-hover:hover {
            background: rgba(255, 255, 255, 0.85);
            transform: translateY(-2px);
            box-shadow: 0 12px 40px 0 rgba(31, 38, 135, 0.1);
            border-color: rgba(255, 255, 255, 0.8);
        }

        .animate-enter { animation: enter 0.6s cubic-bezier(0.16, 1, 0.3, 1); }
        
        @keyframes enter {
            from { opacity: 0; transform: translateY(20px) scale(0.98); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }
        
        .modal-overlay {
            background-color: rgba(15, 23, 42, 0.3);
            backdrop-filter: blur(8px);
        }

        /* Gr√°ficos CSS */
        .chart-bar { transition: height 1s cubic-bezier(0.34, 1.56, 0.64, 1); }
        .chart-segment { transition: stroke-dasharray 1s ease-out; }
    </style>
</head>
<body class="bg-[#F0F2F5] text-slate-800 min-h-screen selection:bg-indigo-500 selection:text-white">

    <!-- Fondo ambiental -->
    <div class="fixed inset-0 -z-10 overflow-hidden">
        <div class="absolute top-[-10%] left-[-10%] w-[40%] h-[40%] rounded-full bg-purple-200/30 blur-[100px]"></div>
        <div class="absolute bottom-[-10%] right-[-10%] w-[40%] h-[40%] rounded-full bg-indigo-200/30 blur-[100px]"></div>
        <div class="absolute top-[20%] right-[20%] w-[30%] h-[30%] rounded-full bg-emerald-200/20 blur-[100px]"></div>
    </div>

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- ICONOS SVG ---
        const Icon = ({ name, className }) => {
            const icons = {
                Shield: <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" />,
                TrendingDown: <g><polyline points="23 18 13.5 8.5 8.5 13.5 1 6" /><polyline points="17 18 23 18 23 12" /></g>,
                TrendingUp: <g><polyline points="23 6 13.5 15.5 8.5 10.5 1 18" /><polyline points="17 6 23 6 23 12" /></g>,
                AlertTriangle: <g><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z" /><line x1="12" y1="9" x2="12" y2="13" /><line x1="12" y1="17" x2="12.01" y2="17" /></g>,
                DollarSign: <g><line x1="12" y1="1" x2="12" y2="23" /><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6" /></g>,
                Target: <g><circle cx="12" cy="12" r="10" /><circle cx="12" cy="12" r="6" /><circle cx="12" cy="12" r="2" /></g>,
                Wallet: <g><path d="M20 12V8H6a2 2 0 0 1-2-2c0-1.1.9-2 2-2h12v4" /><path d="M4 6v12a2 2 0 0 0 2 2h14v-4" /><path d="M18 12a2 2 0 0 0-2 2c0 1.1.9 2 2 2h4v-4h-4z" /></g>,
                BrainCircuit: <g><path d="M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z" /><path d="M9 13a4.5 4.5 0 0 0 3-4" /><path d="M6.003 5.125A3 3 0 0 0 6.401 6.5" /><path d="M3.477 10.896a4 4 0 0 1 .585-.396" /><path d="M6 18a4 4 0 0 1-1.97-3.484" /><path d="M12 18a4 4 0 0 0 1.134-3.055" /><path d="M10.605 9H13.8" /></g>,
                Trash2: <g><polyline points="3 6 5 6 21 6" /><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" /><line x1="10" y1="11" x2="10" y2="17" /><line x1="14" y1="11" x2="14" y2="17" /></g>,
                Calendar: <g><rect x="3" y="4" width="18" height="18" rx="2" ry="2" /><line x1="16" y1="2" x2="16" y2="6" /><line x1="8" y1="2" x2="8" y2="6" /><line x1="3" y1="10" x2="21" y2="10" /></g>,
                Sparkles: <path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275-1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z" />,
                Bot: <g><rect width="18" height="10" x="3" y="11" rx="2" /><circle cx="12" cy="5" r="2" /><path d="M12 7v4" /><line x1="8" y1="16" x2="8" y2="16" /><line x1="16" y1="16" x2="16" y2="16" /></g>,
                ArrowUpRight: <g><line x1="7" y1="17" x2="17" y2="7" /><polyline points="7 7 17 7 17 17" /></g>,
                Plus: <g><line x1="12" y1="5" x2="12" y2="19" /><line x1="5" y1="12" x2="19" y2="12" /></g>,
                Minus: <line x1="5" y1="12" x2="19" y2="12" />,
                Edit: <g><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" /><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" /></g>,
                Check: <polyline points="20 6 9 17 4 12" />,
                Settings: <g><circle cx="12" cy="12" r="3" /><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z" /></g>,
                ChartPie: <g><path d="M21.21 15.89A10 10 0 1 1 8 2.83" /><path d="M22 12A10 10 0 0 0 12 2v10z" /></g>,
                Flag: <g><path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z" /><line x1="4" y1="22" x2="4" y2="15" /></g>,
                Feather: <g><path d="M20.24 12.24a6 6 0 0 0-8.49-8.49L5 10.5V19h8.5z" /><line x1="16" y1="8" x2="2" y2="22" /><line x1="17.5" y1="15" x2="9" y2="15" /></g>,
                Briefcase: <g><rect x="2" y="7" width="20" height="14" rx="2" ry="2" /><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16" /></g>,
                Lightbulb: <g><line x1="9" y1="18" x2="15" y2="18" /><line x1="10" y1="22" x2="14" y2="22" /><path d="M15.09 14c.18-.98.65-1.74 1.41-2.5A4.65 4.65 0 0 0 12 2a4.65 4.65 0 0 0-4.5 9.5c.7.7 1.23 1.52 1.41 2.5" /></g>
            };
            return (
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    {icons[name] || <circle cx="12" cy="12" r="10" />}
                </svg>
            );
        };

        // --- COMPONENTES VISUALES ---
        const GlassCard = ({ children, className = "" }) => (
            <div className={`glass-panel rounded-3xl transition-all duration-300 ${className}`}>
                {children}
            </div>
        );

        const Button = ({ children, onClick, className = "", variant = "primary", disabled = false, size="md" }) => {
            const sizes = { xs: "px-2 py-1 text-xs", sm: "px-3 py-1.5 text-xs", md: "px-5 py-2.5 text-sm", lg: "px-6 py-3 text-base" };
            const variants = {
                primary: "bg-slate-900 text-white hover:bg-slate-800 shadow-lg shadow-slate-900/20 active:translate-y-0.5",
                indigo: "bg-indigo-600 text-white hover:bg-indigo-700 shadow-lg shadow-indigo-500/30 active:translate-y-0.5",
                emerald: "bg-emerald-600 text-white hover:bg-emerald-700 shadow-lg shadow-emerald-500/30 active:translate-y-0.5",
                ghost: "bg-transparent text-slate-500 hover:bg-white/50 hover:text-slate-800",
                danger: "bg-rose-600 text-white hover:bg-rose-700 shadow-lg shadow-rose-500/30",
                outline: "border border-slate-300 text-slate-700 hover:bg-white/60 backdrop-blur-sm"
            };
            return (
                <button onClick={onClick} disabled={disabled} className={`rounded-xl font-semibold transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center ${sizes[size] || sizes.md} ${variants[variant] || variants.primary} ${className}`}>
                    {children}
                </button>
            );
        };

        const Input = ({ type = "text", value, onChange, placeholder, className = "" }) => (
            <input 
                type={type} 
                value={value} 
                onChange={onChange} 
                placeholder={placeholder}
                className={`w-full px-4 py-3 rounded-xl bg-white/40 border border-white/60 focus:outline-none focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 focus:bg-white/70 transition-all backdrop-blur-sm placeholder:text-slate-400 ${className}`}
            />
        );

        const Select = ({ value, onChange, options, className = "" }) => (
            <div className="relative">
                <select 
                    value={value} 
                    onChange={onChange} 
                    className={`w-full px-4 py-3 rounded-xl bg-white/40 border border-white/60 focus:outline-none focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 focus:bg-white/70 transition-all backdrop-blur-sm appearance-none ${className}`}
                >
                    <option value="" disabled>Selecciona...</option>
                    {options.map(opt => <option key={opt.value} value={opt.value}>{opt.label}</option>)}
                </select>
                <div className="absolute right-4 top-1/2 -translate-y-1/2 pointer-events-none text-slate-400">
                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>
                </div>
            </div>
        );

        const ProgressBar = ({ value, className = "", color = "bg-slate-900" }) => (
            <div className={`w-full bg-slate-200/50 rounded-full h-3 overflow-hidden ${className}`}>
                <div className={`${color} h-full rounded-full chart-bar`} style={{ width: `${Math.min(Math.max(value, 0), 100)}%` }}></div>
            </div>
        );

        // --- GR√ÅFICOS (SIMPLIFICADOS) ---
        const SimpleDonutChart = ({ data }) => {
            const total = data.reduce((acc, item) => acc + item.value, 0);
            let cumulativePercent = 0;
            if (total === 0) return <div className="h-48 w-48 rounded-full border-4 border-slate-100 flex items-center justify-center text-xs text-slate-400">Sin datos</div>;
            return (
                <div className="relative h-48 w-48">
                    <svg viewBox="0 0 100 100" className="transform -rotate-90 w-full h-full">
                        {data.map((item, i) => {
                            const percent = item.value / total;
                            const dashArray = `${percent * 314} 314`; 
                            const offset = -(cumulativePercent * 314);
                            cumulativePercent += percent;
                            const colors = { 'text-indigo-600': '#4F46E5', 'text-emerald-600': '#059669', 'text-rose-600': '#E11D48', 'text-purple-600': '#7C3AED', 'text-blue-600': '#2563EB', 'text-slate-600': '#475569' };
                            return <circle key={i} cx="50" cy="50" r="40" fill="transparent" stroke={colors[item.color] || '#cbd5e1'} strokeWidth="12" strokeDasharray={dashArray} strokeDashoffset={offset} className="chart-segment" />;
                        })}
                    </svg>
                    <div className="absolute inset-0 flex flex-col items-center justify-center"><span className="text-2xl font-bold text-slate-800">RD$</span><span className="text-xs text-slate-500 uppercase tracking-wide">Total</span></div>
                </div>
            );
        };

        const SimpleBarChart = ({ data }) => {
            const maxVal = Math.max(...data.map(d => d.value), 1);
            return (
                <div className="flex items-end justify-between h-48 gap-2 pt-6">
                    {data.map((d, i) => (
                        <div key={i} className="flex-1 flex flex-col items-center gap-2 group">
                            <div className="w-full bg-slate-100/50 rounded-t-lg relative h-full flex items-end overflow-hidden group-hover:bg-slate-100 transition-colors">
                                <div className="w-full bg-gradient-to-t from-indigo-600 to-purple-500 opacity-80 group-hover:opacity-100 rounded-t-lg chart-bar relative" style={{ height: `${(d.value / maxVal) * 100}%` }}>
                                    <div className="absolute -top-8 left-1/2 -translate-x-1/2 bg-slate-800 text-white text-[10px] px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap z-10 pointer-events-none">${d.value.toLocaleString()}</div>
                                </div>
                            </div>
                            <span className="text-xs font-medium text-slate-400 group-hover:text-indigo-600">{d.label}</span>
                        </div>
                    ))}
                </div>
            );
        };

        const Modal = ({ isOpen, onClose, title, children }) => {
            if (!isOpen) return null;
            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center modal-overlay p-4 animate-enter">
                    <div className="bg-white/90 backdrop-blur-xl rounded-3xl shadow-2xl w-full max-w-md overflow-hidden border border-white/50">
                        <div className="p-6 border-b border-slate-100 flex justify-between items-center bg-slate-50/50">
                            <h3 className="font-bold text-lg text-slate-800">{title}</h3>
                            <button onClick={onClose} className="text-slate-400 hover:text-slate-600 p-1 hover:bg-slate-100 rounded-full transition-all"><Icon name="Trash2" className="h-5 w-5 rotate-45" /></button>
                        </div>
                        <div className="p-6">
                            {children}
                        </div>
                    </div>
                </div>
            );
        };

        // --- APP PRINCIPAL ---
        const PlanFenixDashboard = () => {
            // API KEY & SETTINGS
            const [userApiKey, setUserApiKey] = useState(() => localStorage.getItem('fenix_api_key') || "");
            const [settingsModal, setSettingsModal] = useState(false);
            const [tempKey, setTempKey] = useState("");

            // DATOS PERSISTENTES
            const [savings, setSavings] = useState(() => { const s = localStorage.getItem('fenix_savings'); return s ? JSON.parse(s) : { pesos: 0, dolares: 0 }; });
            const [myPlan, setMyPlan] = useState(() => localStorage.getItem('fenix_plan') || `1. ENTREGAR VEH√çCULO üöó\n2. BLINDAR VIVIENDA üè†\n3. BOLA DE NIEVE (DEUDAS) ‚ùÑÔ∏è\n4. AHORRO (DULUS) ‚úàÔ∏è`);
            const [debts, setDebts] = useState(() => { const d = localStorage.getItem('fenix_debts'); return d ? JSON.parse(d) : [ {id:1, name:'TDC Banesco', amount:44546, original:44546, priority:'Alta'}, {id:2, name:'TDC Promerica', amount:172500, original:172500, priority:'Alta'}, {id:3, name:'Atraso Apto', amount:90000, original:90000, priority:'Cr√≠tica'} ]; });
            const [transactions, setTransactions] = useState(() => { const t = localStorage.getItem('fenix_transactions'); return t ? JSON.parse(t) : []; });
            
            // NUEVO: GASTOS FIJOS
            const [expenses, setExpenses] = useState(() => {
                const e = localStorage.getItem('fenix_expenses');
                return e ? JSON.parse(e) : [
                    { id: 1, name: 'Alquiler', amount: 22500 },
                    { id: 2, name: 'Combustible', amount: 2000 },
                    { id: 3, name: 'Comida (Mensual)', amount: 15165 },
                    { id: 4, name: 'Servicios (Luz/Net)', amount: 4000 },
                    { id: 5, name: 'Gym / Streaming', amount: 4500 },
                    { id: 6, name: 'Herramientas', amount: 800 }
                ];
            });
            const [estimatedIncome, setEstimatedIncome] = useState(() => localStorage.getItem('fenix_est_income') || "116583"); // Default basado en conversaci√≥n

            // UI STATES
            const [activeTab, setActiveTab] = useState('dashboard');
            const [newIncome, setNewIncome] = useState({ type: '', amount: '' });
            // --- NUEVO ESTADO PARA FECHA ---
            const [incomeDate, setIncomeDate] = useState(new Date().toISOString().split('T')[0]);
            
            const [suggestion, setSuggestion] = useState(null);
            
            // MODALES
            const [payingDebtId, setPayingDebtId] = useState(null);
            const [paymentAmount, setPaymentAmount] = useState('');
            const [fundModal, setFundModal] = useState({ isOpen: false, type: 'pesos', action: 'add' });
            const [fundAmount, setFundAmount] = useState('');
            const [debtModal, setDebtModal] = useState({ isOpen: false, mode: 'add', data: null });
            const [debtForm, setDebtForm] = useState({ name: '', amount: '', original: '', priority: 'Media' });
            const [expenseModal, setExpenseModal] = useState({ isOpen: false, mode: 'add', data: null });
            const [expenseForm, setExpenseForm] = useState({ name: '', amount: '' });

            // IA
            const [coachQuestion, setCoachQuestion] = useState('');
            const [aiAdvice, setAiAdvice] = useState(null);
            const [isAiLoading, setIsAiLoading] = useState(false);

            // PERSISTENCIA
            useEffect(() => localStorage.setItem('fenix_savings', JSON.stringify(savings)), [savings]);
            useEffect(() => localStorage.setItem('fenix_debts', JSON.stringify(debts)), [debts]);
            useEffect(() => localStorage.setItem('fenix_transactions', JSON.stringify(transactions)), [transactions]);
            useEffect(() => localStorage.setItem('fenix_plan', myPlan), [myPlan]);
            useEffect(() => localStorage.setItem('fenix_api_key', userApiKey), [userApiKey]);
            useEffect(() => localStorage.setItem('fenix_expenses', JSON.stringify(expenses)), [expenses]);
            useEffect(() => localStorage.setItem('fenix_est_income', estimatedIncome), [estimatedIncome]);

            // CALCULOS
            const totalDebt = debts.reduce((acc, curr) => acc + curr.amount, 0);
            const totalFixedExpenses = expenses.reduce((acc, curr) => acc + curr.amount, 0);
            const debtCapacity = parseFloat(estimatedIncome || 0) - totalFixedExpenses;
            
            // L√≥gica Sugerencia de Pago Deuda
            const suggestedDebt = debts.filter(d => d.amount > 0).sort((a, b) => {
                // Prioridad: Cr√≠tica > Alta > Media > Baja
                const priorities = { 'Cr√≠tica': 4, 'Alta': 3, 'Media': 2, 'Baja': 1 };
                if (priorities[b.priority] !== priorities[a.priority]) return priorities[b.priority] - priorities[a.priority];
                return a.amount - b.amount; // Si igual prioridad, menor monto (Bola de Nieve)
            })[0];

            // --- L√≥gica Reportes ---
            const reportData = useMemo(() => {
                const incomeByType = {}; const incomeByMonth = {}; let totalIncome = 0;
                transactions.forEach(tx => {
                    if (tx.amount > 0 && tx.type !== 'ajuste_fondo') {
                        const typeLabel = { 'dulus': 'Dulus', 'excursion': 'Excursi√≥n', 'salario': 'Salario', 'fotografia': 'Foto', 'comision': 'Comisi√≥n', 'incentivo': 'Incentivo' }[tx.type] || tx.type;
                        incomeByType[typeLabel] = (incomeByType[typeLabel] || 0) + tx.amount;
                        // Correcci√≥n: Usar tx.month directamente o parsear si se guard√≥ string completo
                        // Como ahora guardamos "Enero 2024", substring(0,3) funciona bien para "Ene"
                        const monthShort = tx.month.substring(0, 3); 
                        incomeByMonth[monthShort] = (incomeByMonth[monthShort] || 0) + tx.amount;
                        totalIncome += tx.amount;
                    }
                });
                const donutData = Object.keys(incomeByType).map(key => ({ label: key, value: incomeByType[key], color: key.includes('Dulus') ? 'text-emerald-600' : key.includes('Excur') ? 'text-rose-600' : key.includes('Salar') ? 'text-slate-600' : 'text-indigo-600' }));
                const barData = Object.keys(incomeByMonth).map(key => ({ label: key, value: incomeByMonth[key] })).slice(-6);
                return { donutData, barData, totalIncome };
            }, [transactions]);

            // --- Efectos y Acciones ---
            useEffect(() => {
                if (!newIncome.amount || !newIncome.type) { setSuggestion(null); return; }
                const amount = parseFloat(newIncome.amount);
                switch (newIncome.type) {
                    case 'dulus': setSuggestion({ title: "Patrimonio (Dulus)", text: `Compra USD $${(amount / 60).toFixed(2)} o guarda en BDI Pesos.`, action: 'save', details: { dolares: amount / 60, pesos: amount }, label: "Ahorro Total", color: "text-emerald-600", bg: "bg-emerald-50/80 border-emerald-200", icon: "TrendingUp" }); break;
                    case 'excursion': setSuggestion({ title: "Ataque Deuda", text: `Abona RD$${amount.toLocaleString()} a Tarjeta Banesco.`, action: 'pay_debt', targetDebtId: 1, label: "Pago Deuda", color: "text-rose-600", bg: "bg-rose-50/80 border-rose-200", icon: "Target" }); break;
                    case 'fotografia': const mitad = amount * 0.50; setSuggestion({ title: "Regla 50/50", text: `RD$${mitad.toLocaleString()} Ahorro / RD$${mitad.toLocaleString()} Deuda.`, action: 'split_debt_save', targetDebtId: 1, details: { save: mitad, pay: mitad }, label: "50% Ahorro / 50% Deuda", color: "text-purple-600", bg: "bg-purple-50/80 border-purple-200", icon: "Wallet" }); break;
                    case 'comision': case 'incentivo': const ahorro = amount * 0.30; const vida = amount * 0.70; setSuggestion({ title: "Regla 30/70", text: `30% Ahorro (RD$${ahorro.toLocaleString()}) / 70% Vida.`, action: 'split', details: { save: ahorro, spend: vida }, label: "Ahorro 30% / Vida 70%", color: "text-blue-600", bg: "bg-blue-50/80 border-blue-200", icon: "Shield" }); break;
                    case 'salario': setSuggestion({ title: "Estabilidad", text: "Registrar ingreso. Destino: Renta, Comida y Cuotas Fijas.", action: 'log', label: "Ingreso Fijo", color: "text-slate-600", bg: "bg-slate-50/80 border-slate-200", icon: "Wallet" }); break;
                    default: setSuggestion(null);
                }
            }, [newIncome]);

            const handleExecuteAction = () => {
                if (!suggestion) return;
                const amount = parseFloat(newIncome.amount);
                
                // --- CORRECCI√ìN FECHA ---
                const [year, month, day] = incomeDate.split('-').map(Number);
                const dateObj = new Date(year, month - 1, day); // Crear fecha local correcta
                const monthName = dateObj.toLocaleString('es-ES', { month: 'long', year: 'numeric' });
                const dateStr = dateObj.toLocaleDateString('es-ES');
                
                const newTx = { id: Math.random().toString(36).substr(2, 9), date: dateStr, month: monthName.charAt(0).toUpperCase() + monthName.slice(1), type: newIncome.type, amount: amount, actionTaken: suggestion.label };
                setTransactions([newTx, ...transactions]);

                if (suggestion.action === 'save') setSavings(prev => ({ ...prev, pesos: prev.pesos + amount }));
                else if (suggestion.action === 'pay_debt') setDebts(prev => prev.map(d => d.id === suggestion.targetDebtId ? { ...d, amount: Math.max(0, d.amount - amount) } : d));
                else if (suggestion.action === 'split') setSavings(prev => ({ ...prev, pesos: prev.pesos + suggestion.details.save }));
                else if (suggestion.action === 'split_debt_save') { setSavings(prev => ({ ...prev, pesos: prev.pesos + suggestion.details.save })); setDebts(prev => prev.map(d => d.id === suggestion.targetDebtId ? { ...d, amount: Math.max(0, d.amount - suggestion.details.pay) } : d)); }
                
                setNewIncome({ type: '', amount: '' }); 
                setSuggestion(null);
                // No reseteamos fecha para permitir ingresos masivos del mismo mes si se desea
            };

            const handleDebtPayment = () => {
                const amount = parseFloat(paymentAmount); if (!amount || amount <= 0) return;
                setDebts(prev => prev.map(d => d.id === payingDebtId ? { ...d, amount: Math.max(0, d.amount - amount) } : d));
                const dateObj = new Date(); const monthName = dateObj.toLocaleString('es-ES', { month: 'long', year: 'numeric' }); const debtName = debts.find(d => d.id === payingDebtId)?.name || 'Deuda';
                setTransactions([{ id: Math.random().toString(36).substr(2, 9), date: dateObj.toLocaleDateString(), month: monthName.charAt(0).toUpperCase() + monthName.slice(1), type: 'pago_manual', amount: -amount, actionTaken: `Pago a ${debtName}` }, ...transactions]);
                setPayingDebtId(null); setPaymentAmount('');
            };

            const handleFundUpdate = () => {
                const amount = parseFloat(fundAmount); if (!amount || amount <= 0) return;
                setSavings(prev => { const current = prev[fundModal.type]; const newValue = fundModal.action === 'add' ? current + amount : Math.max(0, current - amount); return { ...prev, [fundModal.type]: newValue }; });
                const dateObj = new Date(); const monthName = dateObj.toLocaleString('es-ES', { month: 'long', year: 'numeric' }); const typeLabel = fundModal.type === 'pesos' ? 'Pesos' : 'D√≥lares'; const actionLabel = fundModal.action === 'add' ? 'Ingreso Manual' : 'Retiro Manual';
                setTransactions([{ id: Math.random().toString(36).substr(2, 9), date: dateObj.toLocaleDateString(), month: monthName.charAt(0).toUpperCase() + monthName.slice(1), type: 'ajuste_fondo', amount: amount, actionTaken: `${actionLabel} ${typeLabel}` }, ...transactions]);
                setFundModal({...fundModal, isOpen: false}); setFundAmount('');
            };

            // CRUD Deudas & Gastos
            const openAddDebt = () => { setDebtForm({ name: '', amount: '', original: '', priority: 'Media' }); setDebtModal({ isOpen: true, mode: 'add', data: null }); };
            const openEditDebt = (debt) => { setDebtForm({ name: debt.name, amount: debt.amount, original: debt.original, priority: debt.priority }); setDebtModal({ isOpen: true, mode: 'edit', data: debt }); };
            const handleSaveDebt = () => { if (!debtForm.name || !debtForm.amount) return; const amountVal = parseFloat(debtForm.amount); const originalVal = debtForm.original ? parseFloat(debtForm.original) : amountVal; if (debtModal.mode === 'add') setDebts([...debts, { id: Date.now(), name: debtForm.name, amount: amountVal, original: originalVal, priority: debtForm.priority }]); else setDebts(prev => prev.map(d => d.id === debtModal.data.id ? { ...d, name: debtForm.name, amount: amountVal, original: originalVal, priority: debtForm.priority } : d)); setDebtModal({ ...debtModal, isOpen: false }); };
            const handleDeleteDebt = () => { if(confirm("¬øEliminar?")) { setDebts(prev => prev.filter(d => d.id !== debtModal.data.id)); setDebtModal({ ...debtModal, isOpen: false }); } };
            
            const openAddExpense = () => { setExpenseForm({ name: '', amount: '' }); setExpenseModal({ isOpen: true, mode: 'add', data: null }); };
            const openEditExpense = (exp) => { setExpenseForm({ name: exp.name, amount: exp.amount }); setExpenseModal({ isOpen: true, mode: 'edit', data: exp }); };
            const handleSaveExpense = () => { if (!expenseForm.name || !expenseForm.amount) return; const amountVal = parseFloat(expenseForm.amount); if (expenseModal.mode === 'add') setExpenses([...expenses, { id: Date.now(), name: expenseForm.name, amount: amountVal }]); else setExpenses(prev => prev.map(e => e.id === expenseModal.data.id ? { ...e, name: expenseForm.name, amount: amountVal } : e)); setExpenseModal({ ...expenseModal, isOpen: false }); };
            const handleDeleteExpense = () => { if(confirm("¬øEliminar gasto?")) { setExpenses(prev => prev.filter(e => e.id !== expenseModal.data.id)); setExpenseModal({ ...expenseModal, isOpen: false }); } };

            const handleResetData = () => { if(confirm("¬øBORRAR TODO?")) { localStorage.clear(); window.location.reload(); } };
            const saveApiKey = () => { setUserApiKey(tempKey); setSettingsModal(false); alert("Guardado"); };

            const callGemini = async () => {
                if (!userApiKey) { setSettingsModal(true); return; }
                setIsAiLoading(true);
                const prompt = `Coach Financiero. Deuda Total: ${totalDebt}. Ahorros: ${savings.pesos}. Disponibilidad Mensual Calculada: ${debtCapacity}. Pregunta: ${coachQuestion}. Responde corto y motivador.`;
                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${userApiKey}`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] }) });
                    const data = await response.json();
                    if(data.error) throw new Error(data.error.message);
                    setAiAdvice(data.candidates?.[0]?.content?.parts?.[0]?.text);
                } catch (e) { setAiAdvice("Error de conexi√≥n. Verifica API Key."); } finally { setIsAiLoading(false); }
            };

            return (
                <div className="max-w-7xl mx-auto p-4 md:p-8 space-y-8 animate-enter pb-20">
                    
                    {/* TOP NAV & HEADER */}
                    <div className="flex flex-col md:flex-row justify-between items-center gap-6">
                        <div className="flex items-center gap-4">
                            <div className="h-12 w-12 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-2xl flex items-center justify-center shadow-lg shadow-indigo-500/30 text-white"><Icon name="Feather" /></div>
                            <div><h1 className="text-3xl font-bold font-display text-slate-900 tracking-tight">F√©nix OS</h1><p className="text-slate-500 font-medium">Arquitectura de Libertad</p></div>
                        </div>
                        <div className="flex bg-white/60 backdrop-blur-md rounded-full p-1.5 border border-white/60 shadow-sm overflow-x-auto max-w-full">
                            {[ {id:'dashboard', l:'Operaciones', i:'Sparkles'}, {id:'funds', l:'Fondos', i:''}, {id:'expenses', l:'Gastos Fijos', i:'Briefcase'}, {id:'debts', l:'Deudas', i:''}, {id:'coach', l:'Coach', i:'Sparkles'}, {id:'reports', l:'Reportes', i:''}, {id:'plan', l:'Mi Plan', i:''} ].map(t => (
                                <button key={t.id} onClick={() => setActiveTab(t.id)} className={`px-5 py-2 rounded-full text-sm font-semibold transition-all whitespace-nowrap flex items-center gap-2 ${activeTab === t.id ? 'bg-slate-900 text-white shadow-md' : 'text-slate-500 hover:text-slate-900'}`}>
                                    {t.i === 'Sparkles' && <Icon name="Sparkles" className="h-3 w-3" />}
                                    {t.i === 'Briefcase' && <Icon name="Wallet" className="h-3 w-3" />}
                                    {t.l}
                                </button>
                            ))}
                        </div>
                        <div className="flex items-center gap-2"><Button variant="ghost" onClick={() => setSettingsModal(true)} size="sm"><Icon name="Settings" className="w-5 h-5"/></Button></div>
                    </div>

                    {/* VISTAS */}
                    
                    {/* 1. OPERACIONES */}
                    {activeTab === 'dashboard' && (
                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-8 animate-enter">
                            <GlassCard className="p-8 h-fit border-t-4 border-t-indigo-500">
                                <h2 className="text-xl font-bold text-slate-800 flex items-center gap-2 mb-6"><div className="p-2 bg-indigo-100 rounded-lg text-indigo-600"><Icon name="DollarSign" className="h-5 w-5"/></div>Registrar Ingreso</h2>
                                <div className="space-y-6">
                                    <div className="space-y-2"><label className="text-xs font-bold text-slate-400 uppercase ml-1">Fecha</label><Input type="date" value={incomeDate} onChange={(e) => setIncomeDate(e.target.value)} className="text-lg font-bold" /></div>
                                    <div className="space-y-2"><label className="text-xs font-bold text-slate-400 uppercase ml-1">Fuente</label><Select value={newIncome.type} onChange={(e) => setNewIncome({...newIncome, type: e.target.value})} options={[{value:'dulus',label:'‚úàÔ∏è Dulus Travel'},{value:'excursion',label:'üéí Excursiones'},{value:'fotografia',label:'üì∑ Fotograf√≠a'},{value:'comision',label:'üíº Comisiones'},{value:'incentivo',label:'üí∞ Incentivos'},{value:'salario',label:'üè¢ Sueldo Fijo'}]} /></div>
                                    <div className="space-y-2"><label className="text-xs font-bold text-slate-400 uppercase ml-1">Monto (RD$)</label><Input type="number" placeholder="0.00" value={newIncome.amount} onChange={(e) => setNewIncome({...newIncome, amount: e.target.value})} className="text-lg font-bold" /></div>
                                    {suggestion && (<div className={`p-5 rounded-2xl border ${suggestion.bg} animate-enter`}><div className="flex gap-4"><div className={`p-3 rounded-xl bg-white/60 ${suggestion.color}`}><Icon name={suggestion.icon} className="h-6 w-6"/></div><div className="flex-1"><h4 className={`font-bold ${suggestion.color}`}>{suggestion.title}</h4><p className="text-sm text-slate-700 mt-1">{suggestion.text}</p></div></div><Button onClick={handleExecuteAction} className="w-full mt-4 h-12 text-base rounded-xl">{suggestion.action === 'log' ? 'Guardar' : 'Ejecutar'} <Icon name="ArrowUpRight" className="ml-2 h-4 w-4"/></Button></div>)}
                                </div>
                            </GlassCard>
                            <GlassCard className="p-8"><h3 className="font-bold text-lg text-slate-700 mb-6">Actividad Reciente</h3>{transactions.length === 0 ? <div className="text-center py-10 text-slate-400">Sin movimientos</div> : (<div className="space-y-3">{transactions.slice(0, 5).map(tx => (<div key={tx.id} className="flex justify-between items-center p-3 hover:bg-white/50 rounded-xl transition-colors border-b border-slate-100 last:border-0"><div className="flex items-center gap-3"><div className={`w-8 h-8 rounded-full flex items-center justify-center ${tx.amount > 0 ? 'bg-emerald-100 text-emerald-600' : 'bg-slate-100 text-slate-500'}`}><Icon name={tx.amount > 0 ? "TrendingUp" : "TrendingDown"} className="h-4 w-4"/></div><div><p className="font-bold text-sm text-slate-800">{tx.actionTaken}</p><p className="text-xs text-slate-400">{tx.date}</p></div></div><span className={`font-bold text-sm ${tx.amount > 0 ? 'text-emerald-600' : 'text-slate-600'}`}>{tx.amount > 0 ? '+' : ''}{tx.amount.toLocaleString()}</span></div>))}</div>)}</GlassCard>
                        </div>
                    )}

                    {/* 2. MIS FONDOS */}
                    {activeTab === 'funds' && (
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-8 animate-enter">
                            <GlassCard className="p-8 border-l-4 border-l-indigo-500 glass-card-hover"><div className="flex justify-between mb-8"><div><h2 className="text-xs font-bold text-slate-400 uppercase tracking-widest">Fondo Paz</h2><div className="text-4xl font-display font-bold text-indigo-700 mt-2">RD$ {savings.pesos.toLocaleString()}</div></div><div className="p-4 bg-indigo-50 rounded-2xl text-indigo-500"><Icon name="Shield" className="h-8 w-8"/></div></div><div className="flex gap-3"><Button variant="indigo" onClick={() => setFundModal({isOpen: true, type: 'pesos', action: 'add'})} className="flex-1"><Icon name="Plus" className="h-4 w-4 mr-2"/>Ingresar</Button><Button variant="outline" onClick={() => setFundModal({isOpen: true, type: 'pesos', action: 'subtract'})} className="flex-1">Retirar</Button></div></GlassCard>
                            <GlassCard className="p-8 border-l-4 border-l-emerald-500 glass-card-hover"><div className="flex justify-between mb-8"><div><h2 className="text-xs font-bold text-slate-400 uppercase tracking-widest">Fondo Libertad</h2><div className="text-4xl font-display font-bold text-emerald-700 mt-2">USD$ {savings.dolares.toLocaleString()}</div></div><div className="p-4 bg-emerald-50 rounded-2xl text-emerald-500"><Icon name="TrendingUp" className="h-8 w-8"/></div></div><div className="flex gap-3"><Button variant="emerald" onClick={() => setFundModal({isOpen: true, type: 'dolares', action: 'add'})} className="flex-1"><Icon name="Plus" className="h-4 w-4 mr-2"/>Ingresar</Button><Button variant="outline" onClick={() => setFundModal({isOpen: true, type: 'dolares', action: 'subtract'})} className="flex-1">Retirar</Button></div></GlassCard>
                        </div>
                    )}

                    {/* 3. GASTOS FIJOS (NUEVA PESTA√ëA) */}
                    {activeTab === 'expenses' && (
                        <div className="space-y-6 animate-enter">
                            <div className="flex justify-between items-center"><h2 className="text-xl font-bold text-slate-800">Compromisos Fijos Mensuales</h2><Button onClick={openAddExpense} size="sm" variant="indigo"><Icon name="Plus" className="h-4 w-4 mr-2"/> Agregar Gasto</Button></div>
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                                <GlassCard className="p-6 bg-slate-800 text-white flex flex-col justify-between col-span-1 md:col-span-3 lg:col-span-1">
                                    <div><p className="text-slate-400 font-bold uppercase text-xs">Total Mensual</p><h3 className="text-4xl font-display font-bold mt-2">RD$ {totalFixedExpenses.toLocaleString()}</h3></div>
                                    <div className="mt-4 p-3 bg-white/10 rounded-xl text-sm"><p className="flex items-center gap-2"><Icon name="Target" className="h-4 w-4 text-emerald-400"/> Meta: Mantener bajo control</p></div>
                                </GlassCard>
                                {expenses.map(exp => (
                                    <GlassCard key={exp.id} className="p-5 flex justify-between items-center group">
                                        <div><h4 className="font-bold text-slate-800 text-lg">{exp.name}</h4><p className="text-slate-500 font-medium">RD$ {exp.amount.toLocaleString()}</p></div>
                                        <Button variant="ghost" size="sm" onClick={() => openEditExpense(exp)} className="opacity-0 group-hover:opacity-100 transition-opacity"><Icon name="Edit" className="h-4 w-4 text-slate-400"/></Button>
                                    </GlassCard>
                                ))}
                            </div>
                        </div>
                    )}

                    {/* 4. DEUDAS (ACTUALIZADO CON ESTRATEGIA) */}
                    {activeTab === 'debts' && (
                        <div className="space-y-8 animate-enter">
                            {/* Panel de Estrategia */}
                            <GlassCard className="p-0 overflow-hidden">
                                <div className="bg-gradient-to-r from-slate-900 to-slate-800 p-6 text-white flex flex-col md:flex-row justify-between items-center gap-6">
                                    <div className="flex items-center gap-4">
                                        <div className="p-3 bg-white/10 rounded-xl"><Icon name="Briefcase" className="h-6 w-6"/></div>
                                        <div>
                                            <p className="text-slate-400 text-xs font-bold uppercase">An√°lisis de Capacidad</p>
                                            <div className="flex items-baseline gap-2 mt-1">
                                                <span className="text-sm text-slate-400">Ingreso Est.</span>
                                                <input type="number" value={estimatedIncome} onChange={e => setEstimatedIncome(e.target.value)} className="bg-transparent border-b border-slate-500 w-24 text-white font-bold focus:outline-none focus:border-white text-right" />
                                                <span className="text-sm text-slate-400">- Gastos Fijos =</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div className="text-right">
                                        <p className="text-xs text-slate-400 uppercase font-bold">Disponible Real</p>
                                        <div className={`text-3xl font-display font-bold ${debtCapacity > 0 ? 'text-emerald-400' : 'text-rose-400'}`}>RD$ {debtCapacity.toLocaleString()}</div>
                                    </div>
                                </div>
                                <div className="p-6 bg-indigo-50/50 flex gap-4 items-start">
                                    <div className="p-2 bg-white rounded-lg shadow-sm text-indigo-600"><Icon name="Lightbulb" className="h-5 w-5"/></div>
                                    <div>
                                        <h4 className="font-bold text-indigo-900 text-sm uppercase tracking-wide">Sugerencia del Plan</h4>
                                        <p className="text-slate-700 mt-1 text-sm">
                                            {debtCapacity > 0 ? (
                                                <>Tienes <strong>RD$ {debtCapacity.toLocaleString()}</strong> libres. Seg√∫n el Plan F√©nix, √∫salos para atacar: <strong className="text-rose-600">{suggestedDebt ? suggestedDebt.name : 'Ahorro'}</strong>.</>
                                            ) : (
                                                <>‚ö†Ô∏è <strong className="text-rose-600">D√©ficit de RD$ {Math.abs(debtCapacity).toLocaleString()}</strong>. Prioridad: Generar ingresos extra (Dulus/Excursiones) antes de pagar capital a deudas.</>
                                            )}
                                        </p>
                                    </div>
                                </div>
                            </GlassCard>

                            <div className="flex justify-between items-center"><h2 className="text-xl font-bold text-slate-800">Mis Deudas</h2><Button onClick={openAddDebt} size="sm" variant="indigo"><Icon name="Plus" className="h-4 w-4 mr-2"/> Nueva</Button></div>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                {debts.map(debt => (
                                    <GlassCard key={debt.id} className={`p-6 ${debt.amount === 0 ? 'opacity-50 grayscale' : ''}`}>
                                        <div className="flex justify-between items-start mb-4">
                                            <div><div className="flex items-center gap-2"><h3 className="font-bold text-lg text-slate-800">{debt.name}</h3><button onClick={() => openEditDebt(debt)} className="text-slate-300 hover:text-indigo-500"><Icon name="Edit" className="h-4 w-4"/></button></div><span className={`text-[10px] uppercase font-bold tracking-wider px-2 py-1 rounded-md mt-1 inline-block ${debt.priority.includes('Alta') ? 'bg-rose-100 text-rose-700' : 'bg-slate-100 text-slate-600'}`}>{debt.priority}</span></div>
                                            <div className="text-right"><p className="font-display font-bold text-2xl text-slate-900">RD$ {debt.amount.toLocaleString()}</p><p className="text-xs text-slate-400">de {debt.original.toLocaleString()}</p></div>
                                        </div>
                                        <div className="space-y-4"><ProgressBar value={((debt.original - debt.amount) / debt.original) * 100} color="bg-rose-500" />{debt.amount > 0 && <Button variant="outline" size="sm" className="w-full text-rose-600 border-rose-100 hover:bg-rose-50" onClick={() => setPayingDebtId(debt.id)}>Registrar Pago</Button>}</div>
                                    </GlassCard>
                                ))}
                            </div>
                        </div>
                    )}

                    {/* 5. COACH */}
                    {activeTab === 'coach' && (
                        <GlassCard className="p-0 overflow-hidden max-w-2xl mx-auto animate-enter border-0 shadow-2xl">
                            <div className="bg-gradient-to-r from-indigo-600 to-purple-600 p-10 text-white"><div className="flex items-center gap-4"><div className="p-3 bg-white/20 backdrop-blur-md rounded-2xl"><Icon name="Sparkles" className="h-8 w-8 text-white" /></div><div><h2 className="text-2xl font-bold font-display">Coach F√©nix</h2><p className="text-indigo-100 opacity-80">Inteligencia Artificial Financiera</p></div></div></div>
                            <div className="p-8 bg-white/80 space-y-6">
                                {!userApiKey ? <div className="p-4 bg-amber-50 text-amber-800 rounded-xl text-center"><p>Configura tu API Key en ajustes ‚öôÔ∏è</p></div> : (<><textarea className="w-full p-4 rounded-2xl bg-slate-50 border-0 focus:ring-2 focus:ring-indigo-500 resize-none text-lg" rows="3" placeholder="¬øEn qu√© puedo ayudarte hoy?" value={coachQuestion} onChange={e => setCoachQuestion(e.target.value)}></textarea><Button onClick={callGemini} className="w-full h-12 text-lg shadow-xl shadow-indigo-500/20" disabled={isAiLoading}>{isAiLoading ? 'Pensando...' : 'Consultar'}</Button>{aiAdvice && <div className="p-6 bg-white rounded-2xl shadow-sm border border-slate-100 animate-enter"><div className="flex gap-2 mb-2 text-indigo-600 font-bold"><Icon name="Sparkles" className="h-5 w-5"/>Respuesta</div><p className="text-slate-600 leading-relaxed whitespace-pre-line">{aiAdvice}</p></div>}</>)}
                            </div>
                        </GlassCard>
                    )}

                    {/* 6. REPORTES & PLAN */}
                    {activeTab === 'reports' && (
                        <div className="space-y-8 animate-enter">
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                                <GlassCard className="p-6 flex flex-col justify-between h-32"><span className="text-xs font-bold text-slate-400 uppercase">Ingresos Totales</span><div className="text-3xl font-display font-bold text-slate-800">RD$ {reportData.totalIncome.toLocaleString()}</div></GlassCard>
                                <GlassCard className="p-6 flex flex-col justify-between h-32"><span className="text-xs font-bold text-slate-400 uppercase">Ahorro (Pesos)</span><div className="text-3xl font-display font-bold text-emerald-600">RD$ {savings.pesos.toLocaleString()}</div></GlassCard>
                                <GlassCard className="p-6 flex flex-col justify-between h-32 border-b-4 border-b-emerald-500"><span className="text-xs font-bold text-slate-400 uppercase">Ahorro (D√≥lares)</span><div className="text-3xl font-display font-bold text-emerald-700">USD$ {savings.dolares.toLocaleString()}</div></GlassCard>
                                <GlassCard className="p-6 flex flex-col justify-between h-32"><span className="text-xs font-bold text-slate-400 uppercase">Deuda Actual</span><div className="text-3xl font-display font-bold text-rose-600">RD$ {totalDebt.toLocaleString()}</div></GlassCard>
                            </div>
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-8">
                                <GlassCard className="p-8 col-span-1 flex flex-col items-center"><h3 className="font-bold text-slate-700 mb-6 w-full text-left flex items-center gap-2"><Icon name="ChartPie" className="h-5 w-5 text-indigo-500"/> Fuentes</h3><SimpleDonutChart data={reportData.donutData} /><div className="w-full mt-8 space-y-3">{reportData.donutData.map((d, i) => (<div key={i} className="flex justify-between items-center text-sm"><div className="flex items-center gap-2"><div className={`w-3 h-3 rounded-full ${d.color.replace('text-', 'bg-')}`}></div><span className="text-slate-600">{d.label}</span></div><span className="font-bold text-slate-800">RD$ {d.value.toLocaleString()}</span></div>))}</div></GlassCard>
                                <GlassCard className="p-8 col-span-2 flex flex-col"><h3 className="font-bold text-slate-700 mb-2 flex items-center gap-2"><Icon name="TrendingUp" className="h-5 w-5 text-indigo-500"/> Tendencia de Ingresos</h3><p className="text-sm text-slate-400 mb-6">√öltimos 6 meses</p><div className="flex-1 flex items-end"><SimpleBarChart data={reportData.barData} /></div></GlassCard>
                            </div>
                        </div>
                    )}
                    
                    {activeTab === 'plan' && (
                        <div className="animate-enter">
                            <GlassCard className="p-8">
                                <div className="flex justify-between items-center mb-6"><h2 className="text-xl font-bold text-slate-800 flex items-center gap-2"><Icon name="Flag" className="h-6 w-6 text-indigo-600"/> Mi Estrategia Maestra</h2><span className="text-xs text-slate-400 bg-slate-100 px-3 py-1 rounded-full">Autoguardado activado</span></div>
                                <div className="relative"><textarea className="w-full h-96 p-6 rounded-2xl bg-white/50 border border-slate-200 focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 resize-none text-slate-700 leading-relaxed text-lg font-medium shadow-inner placeholder:text-slate-300" value={myPlan} onChange={(e) => setMyPlan(e.target.value)}></textarea></div>
                            </GlassCard>
                        </div>
                    )}

                    {/* MODALES */}
                    <Modal isOpen={!!payingDebtId} onClose={() => setPayingDebtId(null)} title="Registrar Pago"><Input type="number" placeholder="Monto" value={paymentAmount} onChange={e => setPaymentAmount(e.target.value)} className="mb-4 text-lg font-bold" /><Button onClick={handleDebtPayment} className="w-full">Confirmar</Button></Modal>
                    <Modal isOpen={fundModal.isOpen} onClose={() => setFundModal({...fundModal, isOpen: false})} title="Movimiento de Fondo"><Input type="number" placeholder="Monto" value={fundAmount} onChange={e => setFundAmount(e.target.value)} className="mb-4 text-lg font-bold" /><Button onClick={handleFundUpdate} className="w-full" variant={fundModal.action === 'add' ? 'emerald' : 'danger'}>Confirmar</Button></Modal>
                    <Modal isOpen={debtModal.isOpen} onClose={() => setDebtModal({ ...debtModal, isOpen: false })} title={debtModal.mode === 'add' ? 'Nueva Deuda' : 'Editar'}><div className="space-y-4"><Input value={debtForm.name} onChange={e => setDebtForm({...debtForm, name: e.target.value})} placeholder="Nombre" /><Input type="number" value={debtForm.amount} onChange={e => setDebtForm({...debtForm, amount: e.target.value})} placeholder="Monto Actual" />{debtModal.mode === 'edit' && <Input type="number" value={debtForm.original} onChange={e => setDebtForm({...debtForm, original: e.target.value})} placeholder="Original" />}<div className="flex gap-2">{debtModal.mode === 'edit' && <Button onClick={handleDeleteDebt} variant="danger">Borrar</Button>}<Button onClick={handleSaveDebt} className="flex-1">Guardar</Button></div></div></Modal>
                    <Modal isOpen={expenseModal.isOpen} onClose={() => setExpenseModal({ ...expenseModal, isOpen: false })} title={expenseModal.mode === 'add' ? 'Nuevo Gasto' : 'Editar Gasto'}><div className="space-y-4"><Input value={expenseForm.name} onChange={e => setExpenseForm({...expenseForm, name: e.target.value})} placeholder="Concepto" /><Input type="number" value={expenseForm.amount} onChange={e => setExpenseForm({...expenseForm, amount: e.target.value})} placeholder="Monto Mensual" /><div className="flex gap-2">{expenseModal.mode === 'edit' && <Button onClick={handleDeleteExpense} variant="danger">Borrar</Button>}<Button onClick={handleSaveExpense} className="flex-1">Guardar</Button></div></div></Modal>
                    <Modal isOpen={settingsModal} onClose={() => setSettingsModal(false)} title="Configuraci√≥n"><Input type="password" value={tempKey} onChange={e => setTempKey(e.target.value)} placeholder="API Key de Google" className="mb-4" /><Button onClick={saveApiKey} className="w-full">Guardar</Button></Modal>

                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<PlanFenixDashboard />);
    </script>
</body>
</html>
